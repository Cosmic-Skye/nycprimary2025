<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Democratic Primary 2025: Mamdani vs Cuomo - Prediction</title>
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="NYC Democratic Primary 2025: Mamdani vs Cuomo - Prediction">
    <meta name="description" content="Prediction model for the 2025 NYC Democratic mayoral primary. Analysis of early voting, polling trends, and key factors.">
    <meta name="keywords" content="NYC Primary 2025, Zohran Mamdani, Andrew Cuomo, NYC Mayor Election, Democratic Primary, Election Prediction, NYC Politics">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://elections.cosmicolabs.com/">
    <meta property="og:title" content="NYC Democratic Primary 2025: Mamdani vs Cuomo - Prediction">
    <meta property="og:description" content="Prediction model for the 2025 NYC Democratic mayoral primary. Analysis of early voting, polling trends, and key factors.">
    <meta property="og:image" content="https://elections.cosmicolabs.com/winprob.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="NYC Primary 2025 Analysis">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://elections.cosmicolabs.com/">
    <meta property="twitter:title" content="NYC Democratic Primary 2025: Mamdani vs Cuomo - Prediction">
    <meta property="twitter:description" content="Live prediction model for the 2025 NYC Democratic mayoral primary. See our comprehensive analysis.">
    <meta property="twitter:image" content="https://elections.cosmicolabs.com/winprob.png">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="winprob-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="winprob-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="winprob-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="winprob-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="winprob-icon.png">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "NYC Democratic Primary 2025: Mamdani vs Cuomo - Prediction",
      "description": "Prediction model for the 2025 NYC Democratic mayoral primary. Analysis of early voting, polling trends, and key factors.",
      "url": "https://elections.cosmicolabs.com/",
      "datePublished": "2025-06-23",
      "dateModified": "2025-06-23",
      "author": {
        "@type": "Organization",
        "name": "Elections Analysis"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Cosmic Labs",
        "url": "https://elections.cosmicolabs.com/"
      },
      "image": {
        "@type": "ImageObject",
        "url": "https://elections.cosmicolabs.com/winprob.png",
        "width": 1200,
        "height": 630
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://elections.cosmicolabs.com/"
      }
    }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 40vh;
            width: 100%;
            max-width: 650px;
            max-height: 400px;
        }
        .small-chart-container {
            position: relative;
            margin: auto;
            height: 35vh;
            width: 100%;
            max-width: 350px;
            max-height: 350px;
        }
        .gradient-text {
            background: linear-gradient(to right, #2563eb, #3b82f6, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .flow-arrow {
            color: #d1d5db; /* gray-300 */
            font-size: 2.5rem;
            line-height: 1;
            font-weight: 900;
        }
        .gauge {
            width: 400px;
            height: 200px;
            position: relative;
            overflow: hidden;
            border-top-left-radius: 200px;
            border-top-right-radius: 200px;
        }
        .gauge-inner {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #ef4444 0%, #f87171 20%, #9ca3af 50%, #60a5fa 80%, #3b82f6 100%);
        }
        .gauge-cover {
            width: 320px;
            height: 160px;
            background: #ffffff;
            border-top-left-radius: 160px;
            border-top-right-radius: 160px;
            position: absolute;
            top: 40px;
            left: 40px;
            z-index: 3;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .gauge-value {
            font-size: 3.75rem; /* 60px */
            line-height: 1;
            font-weight: 900;
            color: #3b82f6;
        }
        .gauge-label {
            font-size: 1.25rem; /* 20px */
            line-height: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin-top: 0.5rem;
            text-align: center;
        }
        .gauge-needle {
            width: 4px;
            height: 190px;
            background: #1f2937;
            border-radius: 2px;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(-90deg);
            transition: transform 1.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);
            z-index: 4;
        }
        .gauge-center {
            width: 20px;
            height: 20px;
            background: #1f2937;
            border-radius: 50%;
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
        @media (max-width: 480px) {
            .gauge {
                width: 80vw;
                height: 40vw;
                border-top-left-radius: 40vw;
                border-top-right-radius: 40vw;
            }
            .gauge-cover {
                width: 64vw;
                height: 32vw;
                top: 8vw;
                left: 8vw;
                border-top-left-radius: 32vw;
                border-top-right-radius: 32vw;
            }
            .gauge-value {
                font-size: 10vw;
            }
            .gauge-label {
                font-size: 3.5vw;
                line-height: 1.2;
            }
            .gauge-needle {
                width: max(2px, 1vw);
                height: 38vw;
            }
            .gauge-center {
                width: 4vw;
                height: 4vw;
                bottom: -2vw;
            }
        }
        .candidate-bar {
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        .candidate-bar-fill {
            height: 100%;
            border-radius: 9999px;
            text-align: right;
            padding-right: 0.5rem;
            color: white;
            font-weight: bold;
            font-size: 0.75rem;
            line-height: 1.25rem;
            white-space: nowrap;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-12 pt-12 md:pt-0">
            <div class="fixed top-4 right-4 z-50">
                <a href="https://github.com/Cosmic-Skye/nycprimary2025" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors">
                    <span id="github-text" class="text-sm font-medium transition-opacity duration-300">View on GitHub</span>
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
                    </svg>
                </a>
            </div>
            <h1 class="text-4xl md:text-6xl font-black mb-3">The <span class="gradient-text">Primary Showdown</span></h1>
            <p class="text-xl text-gray-600">An In-Depth Look at the 2025 NYC Democratic Mayoral Primary</p>
        </header>

        <section class="bg-white rounded-2xl shadow-lg p-6 md:p-8 my-12">
            <h2 class="text-3xl md:text-4xl font-black mb-4 text-center">Prediction</h2>
            <p class="text-lg text-gray-600 mb-6 text-center">Prediction Model Run: <span id="model-timestamp">Loading...</span></p>

            <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                <div class="relative w-full max-w-md flex flex-col items-center mt-4">
                    <div class="gauge mx-auto">
                        <div class="gauge-inner"></div>
                        <div class="gauge-cover">
                            <p class="gauge-value" id="win-probability">--</p>
                            <p class="gauge-label">Win Probability</p>
                        </div>
                        <div id="gauge-needle" class="gauge-needle"></div>
                        <div class="gauge-center"></div>
                    </div>
                    <div class="w-full max-w-lg flex justify-between px-2 text-sm text-gray-500 mt-1">
                        <span class="text-left text-[#F94144] font-bold">Cuomo Win</span>
                        <span class="text-gray-400">Toss Up</span>
                        <span class="text-right text-[#3b82f6] font-bold">Mamdani Win</span>
                    </div>
                </div>

                <div class="text-center md:text-left">
                    <h3 class="text-2xl font-bold mb-4">Projected Result</h3>
                    <p class="text-xl font-bold">Final Vote Share: <span class="text-blue-600" id="mamdani-vote-share">--</span> vs <span class="text-red-600" id="cuomo-vote-share">--</span></p>
                    <p class="text-md text-gray-600 mt-2">Projected Victory Margin: <span class="font-bold text-gray-800" id="victory-margin">--</span></p>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-2">Prediction Model: Key Inputs</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">Our model's prediction synthesizes multiple data sources and factors. Here are the key variables included in the analysis.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 mt-6">

                    <!-- Early Vote & Youth Surge -->
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 flex flex-col">
                        <div class="flex items-center mb-3">
                            <div class="text-4xl mr-4">üó≥Ô∏è</div>
                            <h3 class="font-bold text-xl text-blue-800">Early Vote & Youth Surge</h3>
                        </div>
                        <p class="text-blue-700 mb-4">Analysis shows differential early voting patterns by candidate, with higher youth participation than historical averages.</p>
                        <div class="text-center bg-white p-4 rounded-lg flex-grow flex flex-col justify-center">
                            <p class="text-5xl font-extrabold text-blue-600" id="early-vote-advantage">--</p>
                            <p class="font-semibold text-gray-700">Early Vote Differential</p>
                            <p class="text-sm text-gray-500 mt-2">from <span id="total-early-votes">--</span> total early votes</p>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg mt-3 flex-grow flex flex-col justify-center">
                            <p class="text-5xl font-extrabold text-blue-600" id="youth-surge">--</p>
                            <p class="font-semibold text-gray-700">Youth Vote vs. Historical Rate</p>
                            <p class="text-sm text-gray-500 mt-2">Comparison to previous primary elections</p>
                        </div>
                    </div>

                    <!-- Heatwave Impact -->
                    <div class="bg-red-50 p-6 rounded-xl border border-red-200 flex flex-col">
                        <div class="flex items-center mb-3">
                            <div class="text-4xl mr-4">üå°Ô∏è</div>
                            <h3 class="font-bold text-xl text-red-800">Election Day Heatwave</h3>
                        </div>
                        <p class="text-red-700 mb-4">Extreme heat is projected to impact turnout differentially by age group, with older voters historically showing higher sensitivity to weather conditions.</p>
                        <div class="text-center bg-white p-4 rounded-lg flex-grow flex flex-col justify-center">
                            <p class="text-5xl font-extrabold text-red-600" id="temperature">--</p>
                            <p class="font-semibold text-gray-700">Forecasted High Temperature</p>
                            <p class="text-sm text-gray-500 mt-2">with <span id="no-ac-percentage">--</span> of poll sites lacking AC</p>
                        </div>
                        <div class="text-center bg-white p-4 rounded-lg mt-3 flex-grow flex flex-col justify-center">
                            <p class="text-5xl font-extrabold text-red-600" id="senior-suppression">--</p>
                            <p class="font-semibold text-gray-700">Turnout Reduction for 65+</p>
                            <p class="text-sm text-gray-500 mt-2">vs. only <span id="youth-suppression">--</span> for voters under 35</p>
                        </div>
                    </div>

                    <!-- Campaign Momentum -->
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 flex flex-col">
                        <div class="flex items-center mb-3">
                            <div class="text-4xl mr-4">üìà</div>
                            <h3 class="font-bold text-xl text-blue-800">Campaign Momentum</h3>
                        </div>
                        <p class="text-blue-700 mb-4">Polling trends in the final weeks provided a significant tailwind for the Mamdani campaign, helping to close the gap with Cuomo.</p>
                        <div class="text-center bg-white p-4 rounded-lg flex-grow flex flex-col justify-center">
                            <p class="text-5xl font-extrabold text-blue-600">+1.5%</p>
                            <p class="font-semibold text-gray-700">Momentum Shift</p>
                            <p class="text-sm text-gray-500 mt-2">Voters shifting from Cuomo to Mamdani based on polling trends.</p>
                        </div>
                    </div>

                    <!-- RCV Dynamics -->
                    <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200 flex flex-col">
                        <div class="flex items-center mb-3">
                            <div class="text-4xl mr-4">ü§ù</div>
                            <h3 class="font-bold text-xl text-yellow-800">RCV Dynamics</h3>
                        </div>
                        <p class="text-yellow-700 mb-4">Ranked-Choice Voting dynamics show varying transfer patterns between candidates based on endorsements and voter preferences.</p>
                        <div class="text-center bg-white p-4 rounded-lg flex-grow flex flex-col justify-center">
                            <p class="text-5xl font-extrabold text-yellow-600">46%</p>
                            <p class="font-semibold text-gray-700">Lander-to-Mamdani Transfers</p>
                            <p class="text-sm text-gray-500 mt-2">Transfer rates based on historical patterns and current endorsements.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-2">Prediction Details: Ranked-Choice Voting Simulation</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">Our model simulates the Ranked-Choice Voting process round-by-round to determine the projected outcome based on polling data and transfer patterns.</p>
                
                <div class="flex flex-col items-center space-y-6" id="rcv-simulation">
                    <div class="text-gray-600">Loading RCV simulation...</div>
                </div>
                
                <div class="mt-12 pt-8 border-t border-gray-200">
                    <h3 class="text-2xl font-bold text-center mb-4">Model Uncertainty Analysis</h3>
                    <p class="text-center text-gray-600 max-w-2xl mx-auto mb-6">Our model runs 100,000 simulations to capture all sources of uncertainty and provide a realistic range of possible outcomes.</p>
                    <div class="bg-gray-50 rounded-xl p-6 max-w-2xl mx-auto">
                        <div class="text-center">
                            <p class="text-lg text-gray-600 mb-2">95% Confidence Interval</p>
                            <p class="text-4xl font-bold text-gray-800 mb-3" id="prediction-interval">--</p>
                            <p class="text-sm text-gray-500">Based on <span id="monte-carlo-iterations">--</span> Monte Carlo simulations</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-200 text-sm">
                            <div>
                                <p class="font-semibold text-gray-700 mb-1">Sources of Uncertainty:</p>
                                <ul class="text-gray-600 text-left space-y-1">
                                    <li>‚Ä¢ Polling error (¬±3.5%)</li>
                                    <li>‚Ä¢ Early vote split (¬±5%)</li>
                                    <li>‚Ä¢ RCV transfers (¬±10%)</li>
                                    <li>‚Ä¢ Heat impact (¬±10%)</li>
                                </ul>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-700 mb-1">What this means:</p>
                                <p class="text-gray-600 text-left">If the election were held 100 times, we'd expect Mamdani's vote share to fall within this range 95 times.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8">Campaign Resources and Support</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Andrew_Cuomo_2019.jpg/500px-Andrew_Cuomo_2019.jpg" alt="Andrew Cuomo" class="w-32 h-32 rounded-full object-cover object-top mb-4 border-4 border-red-200" onerror="this.onerror=null;this.src='https://placehold.co/128x128/fee2e2/f94144?text=AC';">
                    <h3 class="text-2xl font-bold text-center mb-4">Andrew Cuomo: Campaign Finance</h3>
                    <p class="text-center text-gray-600 mb-6 grow">Cuomo's campaign benefits from significant Super PAC support.</p>
                    <div class="text-center">
                        <p class="text-gray-500 text-lg">"Fix the City" PAC Spending</p>
                        <p class="font-extrabold text-7xl text-[#F94144] my-2">$16M+</p>
                        <p class="text-gray-600">Supported by major donors including Michael Bloomberg.</p>
                    </div>
                    <div class="mt-8">
                        <h4 class="font-bold text-center text-lg mb-3">Key Endorsers</h4>
                        <ul class="text-center text-gray-700 space-y-1">
                            <li>Bill Clinton</li>
                            <li>Michael Bloomberg</li>
                            <li>32BJ SEIU & 1199SEIU</li>
                            <li>NY Daily News</li>
                        </ul>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center">
                    <div class="w-32 h-32 rounded-full overflow-hidden mb-4 border-4 border-blue-200">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Zohran_Mamdani_05.25.25.jpg/500px-Zohran_Mamdani_05.25.25.jpg" alt="Zohran Mamdani" class="w-full h-full object-cover object-top" style="transform: scale(1.2);" onerror="this.onerror=null;this.src='https://placehold.co/128x128/dcfce7/90be6d?text=ZM';">
                    </div>
                    <h3 class="text-2xl font-bold text-center mb-4">Zohran Mamdani: Campaign Operations</h3>
                    <p class="text-center text-gray-600 mb-6 grow">Mamdani's campaign relies primarily on volunteer mobilization and small-dollar contributions.</p>
                    <div class="text-center">
                        <p class="text-gray-500 text-lg">Mobilized Volunteers</p>
                        <p class="font-extrabold text-7xl text-[#3b82f6] my-2">46,000</p>
                        <p class="text-gray-600">The campaign reports over 1 million door knocks across the city.</p>
                    </div>
                     <div class="mt-8">
                        <h4 class="font-bold text-center text-lg mb-3">Key Endorsers</h4>
                        <ul class="text-center text-gray-700 space-y-1">
                            <li>Alexandria Ocasio-Cortez</li>
                            <li>Bernie Sanders</li>
                            <li>Working Families Party</li>
                            <li>Brad Lander</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-2">Key Factors in the Analysis</h2>
            <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">Several factors contribute to the model's projections, including weather conditions, polling trends, and early voting patterns.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col justify-center items-center text-center">
                    <div class="text-5xl mb-3">‚òÄÔ∏è</div>
                    <h3 class="text-xl font-bold mb-2">Election Day Heatwave</h3>
                    <p class="text-6xl font-extrabold text-[#F3722C]" id="heat-index">--</p>
                    <p class="text-md text-gray-600 mt-2">A severe heatwave and lack of AC at <span id="no-ac-sites">--</span> of poll sites could be catastrophic for Cuomo's older base.</p>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col justify-center items-center text-center">
                    <div class="text-5xl mb-3">üìà</div>
                    <h3 class="text-xl font-bold mb-2">Mamdani's Momentum</h3>
                    <p class="text-6xl font-extrabold text-[#3b82f6]">+14 pts</p>
                    <p class="text-md text-gray-600 mt-2">Mamdani's support surged from 18% to 32% in the final polls, while Cuomo's remained stagnant.</p>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col justify-center items-center text-center">
                     <div class="text-5xl mb-3">üó≥Ô∏è</div>
                    <h3 class="text-xl font-bold mb-2">Banked Vote Lead</h3>
                    <p class="text-6xl font-extrabold text-[#3b82f6]" id="banked-lead">--</p>
                    <p class="text-md text-gray-600 mt-2">Current early vote tallies show differential support among the <span id="early-vote-total">--</span> ballots already cast.</p>
                </div>
            </div>
        </section>
        
        <section class="mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-4">Early Voting by Borough</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">Early vote turnout varied significantly by borough, with Brooklyn and Manhattan accounting for 69% of all early votes cast.</p>
                <div class="chart-container">
                    <canvas id="earlyVoteBoroughChart"></canvas>
                </div>
            </div>
        </section>
        
        <section class="mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-4">Polling Trends Over Time</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">Polling data shows evolving voter preferences throughout the campaign, with significant movement in the final weeks that has narrowed the margin between candidates.</p>
                <div class="chart-container">
                     <canvas id="momentumChart"></canvas>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-4">Demographic Support Patterns</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">The candidates draw support from different demographic groups, with variations by age, education, and community.</p>
                <div class="chart-container">
                    <canvas id="demographicsChart"></canvas>
                </div>
                 <p class="text-center text-sm text-gray-500 mt-4">Data from the final Emerson College poll shows the candidates' final-round support across key demographic groups.</p>
            </div>
        </section>
        
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-4">Voter Issue Priorities</h2>
            <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">Voters prioritize different issues, with housing costs and crime emerging as leading concerns among different segments of the electorate.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-center mb-4">Top Issue for Mamdani Voters</h3>
                     <div class="small-chart-container">
                        <canvas id="mamdaniIssuesChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-center mb-4">Top Issue for Cuomo Voters</h3>
                     <div class="small-chart-container">
                        <canvas id="cuomoIssuesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        
        <section class="p-8">
            <h2 class="text-2xl font-bold mb-4 text-center">Sources</h2>
            <div class="text-gray-600 text-sm space-y-2 text-left">
                <p><a href="https://github.com/Cosmic-Skye/nycprimary2025/blob/master/model.py" target="_blank" class="text-blue-600 hover:underline">NYC Primary 2025 Prediction Model - Full Code and Methodology</a></p>
                <p><a href="https://emersoncollegepolling.com/" target="_blank" class="text-blue-600 hover:underline">Emerson College Polling - June 2025 NYC Democratic Primary Survey</a></p>
                <p><a href="https://vote.nyc/page/election-results" target="_blank" class="text-blue-600 hover:underline">NYC Board of Elections - Early Voting Turnout Results</a></p>
                <p><a href="https://www.nyccfb.info/follow-the-money/" target="_blank" class="text-blue-600 hover:underline">NYC Campaign Finance Board - 2025 Mayoral Race Financial Disclosures</a></p>
                <p><a href="https://forecast.weather.gov/MapClick.php?lat=40.71&lon=-74.01" target="_blank" class="text-blue-600 hover:underline">National Weather Service - NYC Election Day Forecast</a></p>
                <p><a href="https://www.politico.com/new-york/" target="_blank" class="text-blue-600 hover:underline">Politico New York - Campaign Endorsement Tracking</a></p>
            </div>
        </section>

    </div>

    <script>
    // Global model data variable
    let modelData = null;
    
    // Load model data from JSON
    async function loadModelData() {
        try {
            const response = await fetch('model_results.json');
            if (!response.ok) {
                throw new Error('Failed to load model data');
            }
            modelData = await response.json();
            updatePageWithData();
        } catch (error) {
            console.error('Error loading model data:', error);
            // Fallback to static values if JSON fails to load
            document.getElementById('model-timestamp').textContent = 'Data unavailable';
            document.getElementById('rcv-simulation').innerHTML = '<div class="text-gray-600">Data unavailable</div>';
        }
    }
    
    // Format numbers with commas
    function formatNumber(num) {
        return new Intl.NumberFormat('en-US').format(num);
    }
    
    // Format datetime
    function formatDateTime(isoString) {
        const date = new Date(isoString);
        return date.toLocaleString('en-US', {
            year: 'numeric',
            month: 'numeric',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    }
    
    // Update page elements with model data
    function updatePageWithData() {
        if (!modelData) return;
        
        // Update timestamp
        document.getElementById('model-timestamp').textContent = formatDateTime(modelData.timestamp);
        
        // Update main prediction
        document.getElementById('win-probability').textContent = modelData.summary.mamdani_win_probability + '%';
        document.getElementById('mamdani-vote-share').textContent = `Mamdani ${modelData.summary.mamdani_vote_share}%`;
        document.getElementById('cuomo-vote-share').textContent = `Cuomo ${modelData.summary.cuomo_vote_share}%`;
        document.getElementById('victory-margin').textContent = 
            `${modelData.summary.margin_percentage}% (~${formatNumber(modelData.summary.margin_votes)} votes)`;
        
        // Update early voting stats
        document.getElementById('early-vote-advantage').textContent = 
            `+${formatNumber(modelData.early_voting.mamdani_advantage)}`;
        document.getElementById('total-early-votes').textContent = 
            formatNumber(modelData.early_voting.total_votes);
        document.getElementById('youth-surge').textContent = 
            `${modelData.early_voting.youth_surge_multiplier}x`;
        
        // Update weather impact
        document.getElementById('temperature').textContent = `${modelData.weather_impact.temperature}¬∞F`;
        document.getElementById('no-ac-percentage').textContent = 
            `${(modelData.weather_impact.sites_without_ac / modelData.weather_impact.total_sites * 100).toFixed(1)}%`;
        document.getElementById('senior-suppression').textContent = 
            `-${modelData.weather_impact.impact_by_age['65+']}%`;
        document.getElementById('youth-suppression').textContent = 
            `-${modelData.weather_impact.impact_by_age['18-24']}%`;
        
        // Update other key metrics
        document.getElementById('heat-index').textContent = `${modelData.weather_impact.temperature}¬∞F`;
        document.getElementById('no-ac-sites').textContent = 
            `${(modelData.weather_impact.sites_without_ac / modelData.weather_impact.total_sites * 100).toFixed(1)}%`;
        document.getElementById('banked-lead').textContent = 
            `+${formatNumber(modelData.early_voting.mamdani_advantage)}`;
        document.getElementById('early-vote-total').textContent = 
            formatNumber(modelData.early_voting.total_votes);
        
        // Update Monte Carlo results - use 95% interval if available, otherwise use 90%
        if (modelData.uncertainty.monte_carlo.percentile_2_5 && modelData.uncertainty.monte_carlo.percentile_97_5) {
            document.getElementById('prediction-interval').textContent = 
                `${modelData.uncertainty.monte_carlo.percentile_2_5}% - ${modelData.uncertainty.monte_carlo.percentile_97_5}%`;
        } else {
            // Fallback to 90% interval with wider approximation for 95%
            const lower = modelData.uncertainty.monte_carlo.percentile_5 - 3;
            const upper = modelData.uncertainty.monte_carlo.percentile_95 + 3;
            document.getElementById('prediction-interval').textContent = 
                `${lower.toFixed(1)}% - ${upper.toFixed(1)}%`;
        }
        document.getElementById('monte-carlo-iterations').textContent = 
            formatNumber(modelData.uncertainty.monte_carlo.iterations);
        
        // Generate RCV simulation HTML
        generateRCVSimulation();
        
        // Initialize charts with data
        initializeCharts();
        
        // Update gauge needle
        updateGaugeNeedle(modelData.summary.mamdani_win_probability);
    }
    
    // Generate RCV simulation HTML
    function generateRCVSimulation() {
        if (!modelData || !modelData.rcv_simulation.rounds) return;
        
        const container = document.getElementById('rcv-simulation');
        let html = '';
        
        // Find first and final rounds
        const firstRound = modelData.rcv_simulation.rounds[0];
        const finalRound = modelData.rcv_simulation.rounds[modelData.rcv_simulation.rounds.length - 1];
        
        // Round 1
        html += `
            <div class="w-full max-w-3xl bg-gray-50 p-6 rounded-2xl border border-gray-200 shadow-sm">
                <h3 class="font-bold text-xl text-center mb-1">Round 1: Initial Tally</h3>
                <p class="text-center text-gray-500 text-sm mb-6">Based on ${formatNumber(modelData.turnout.projected_total)} projected total votes, including early vote and heat-suppressed Election Day turnout.</p>
                <div class="space-y-3">`;
        
        firstRound.candidates.forEach(candidate => {
            const color = candidate.name === 'Mamdani' ? '#3b82f6' : 
                         candidate.name === 'Cuomo' ? '#F94144' :
                         candidate.name === 'Lander' ? '#F9C74F' :
                         candidate.name === 'Adams' ? '#F3722C' : '#9CA3AF';
            
            html += `
                <div class="flex items-center">
                    <span class="font-bold w-24">${candidate.name}</span>
                    <div class="w-full candidate-bar h-5">
                        <div class="candidate-bar-fill" style="width: ${candidate.percentage}%; background-color: ${color};">${candidate.percentage}%</div>
                    </div>
                    <span class="text-right w-24 font-semibold text-sm">${formatNumber(candidate.votes)}</span>
                </div>`;
        });
        
        // Add Round 1 elimination info
        if (firstRound.eliminated) {
            html += `
                <div class="mt-4 pt-4 border-t border-gray-300">
                    <p class="text-center font-semibold mb-2">‚ùå ${firstRound.eliminated.charAt(0).toUpperCase() + firstRound.eliminated.slice(1)} Eliminated</p>`;
            
            if (firstRound.transfers) {
                html += `<div class="text-sm space-y-1">`;
                for (const [recipient, votes] of Object.entries(firstRound.transfers)) {
                    if (recipient !== 'exhausted' && votes > 0 && recipient !== firstRound.eliminated) {
                        const color = recipient === 'mamdani' ? '#3b82f6' : 
                                     recipient === 'cuomo' ? '#F94144' : 
                                     recipient === 'lander' ? '#F9C74F' : '#9CA3AF';
                        const recipientName = recipient.charAt(0).toUpperCase() + recipient.slice(1);
                        html += `<p class="text-center"><span class="font-bold" style="color: ${color}">+${formatNumber(Math.round(votes))} votes</span> ‚Üí ${recipientName}</p>`;
                    }
                }
                if (firstRound.transfers.exhausted > 0) {
                    html += `<p class="text-center text-gray-500"><span class="font-bold">${formatNumber(Math.round(firstRound.transfers.exhausted))} votes</span> ‚Üí Exhausted</p>`;
                }
                html += `</div>`;
            }
            html += `</div>`;
        }
        
        html += `</div></div><div class="flow-arrow">‚Üì</div>`;
        
        // Intermediate rounds - show details for rounds 2 and 3
        if (modelData.rcv_simulation.rounds.length > 2) {
            html += `
                <div class="w-full max-w-3xl bg-orange-50 p-6 rounded-2xl border border-orange-200 shadow-sm">
                    <h3 class="font-bold text-xl text-center mb-4 text-orange-800">Intermediate Rounds</h3>
                    <div class="space-y-4">`;
            
            // Show elimination details for middle rounds
            for (let i = 1; i < modelData.rcv_simulation.rounds.length - 1; i++) {
                const round = modelData.rcv_simulation.rounds[i];
                if (round.eliminated) {
                    html += `
                        <div class="text-center">
                            <h4 class="font-semibold">Round ${round.round}: ‚ùå ${round.eliminated.charAt(0).toUpperCase() + round.eliminated.slice(1)} Eliminated</h4>
                            <div class="mt-2 space-y-1 text-sm">`;
                    
                    // Show transfers
                    for (const [recipient, votes] of Object.entries(round.transfers)) {
                        if (recipient !== 'exhausted' && votes > 0 && recipient !== round.eliminated) {
                            const color = recipient === 'mamdani' ? '#3b82f6' : 
                                         recipient === 'cuomo' ? '#F94144' : 
                                         recipient === 'lander' ? '#F9C74F' : '#9CA3AF';
                            html += `<p><span class="font-bold" style="color: ${color}">+${formatNumber(Math.round(votes))} votes</span> ‚Üí ${recipient.charAt(0).toUpperCase() + recipient.slice(1)}</p>`;
                        }
                    }
                    // Add exhausted votes
                    if (round.transfers.exhausted > 0) {
                        html += `<p class="text-gray-500"><span class="font-bold">${formatNumber(Math.round(round.transfers.exhausted))} votes</span> ‚Üí Exhausted</p>`;
                    }
                    html += `</div></div>`;
                }
            }
            
            html += `</div>
                    <div class="mt-6">
                        <h4 class="font-bold text-center text-lg mb-2">Pre-Final Round Standings</h4>
                        <div class="space-y-2 text-sm max-w-md mx-auto">`;
            
            // Show standings before final round - this should be the last round before the final 2
            const lastRoundWithElimination = modelData.rcv_simulation.rounds[modelData.rcv_simulation.rounds.length - 1];
            const activeCandidates = lastRoundWithElimination.candidates.filter(c => c.votes > 0).sort((a, b) => b.votes - a.votes);
            
            activeCandidates.forEach(candidate => {
                html += `<p class="flex justify-between"><strong>${candidate.name}:</strong> <span class="font-semibold">${candidate.percentage}%</span> (${formatNumber(candidate.votes)} votes)</p>`;
            });
            
            html += `</div>
                    </div>
                </div>
                <div class="flow-arrow">‚Üì</div>`;
        }
        
        // Final round
        const lastRound = modelData.rcv_simulation.rounds[modelData.rcv_simulation.rounds.length - 1];
        
        html += `
            <div class="w-full max-w-3xl bg-blue-50 p-6 rounded-2xl border-2 border-blue-300 shadow-lg">
                <h3 class="font-bold text-xl text-center mb-2 text-blue-800">Final Round: Vote Transfers</h3>`;
        
        // Show Lander elimination details if it's the final elimination
        if (lastRound && lastRound.eliminated === 'lander') {
            const landerVotes = lastRound.candidates.find(c => c.name === 'Lander')?.votes || 0;
            const transfers = lastRound.transfers || {};
            
            html += `
                <p class="text-center text-gray-600 mb-6">‚ùå Lander is eliminated. Based on endorsements and historical patterns, votes transfer as shown below.</p>
                
                <div class="bg-white p-4 rounded-lg text-center mb-6">
                    <p class="font-bold text-yellow-800">Lander's ${formatNumber(landerVotes)} Votes Redistribute:</p>
                    <div class="flex justify-center items-center space-x-6 mt-2">
                        <div class="text-blue-700">
                            <p class="font-black text-3xl">${formatNumber(Math.round(transfers.mamdani || 0))}</p>
                            <p class="font-semibold text-sm">(${Math.round((transfers.mamdani / landerVotes) * 100)}%) ‚Üí Mamdani</p>
                        </div>
                        <div class="text-red-700">
                            <p class="font-black text-3xl">${formatNumber(Math.round(transfers.cuomo || 0))}</p>
                            <p class="font-semibold text-sm">(${Math.round((transfers.cuomo / landerVotes) * 100)}%) ‚Üí Cuomo</p>
                        </div>
                        <div class="text-gray-600">
                            <p class="font-black text-3xl">${formatNumber(Math.round(transfers.exhausted || 0))}</p>
                            <p class="font-semibold text-sm">(${Math.round((transfers.exhausted / landerVotes) * 100)}%) Exhausted</p>
                        </div>
                    </div>
                </div>`;
        }
        
        html += `
                <h4 class="font-bold text-center text-lg mb-4">üèÜ Final Result</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="text-center">
                        <p class="font-bold text-2xl">Zohran Mamdani</p>
                        <p class="text-6xl font-black my-2 text-[#3b82f6]">${modelData.rcv_simulation.final_result.mamdani_percentage}%</p>
                        <div class="w-full bg-gray-200 rounded-full h-4 my-2">
                          <div class="bg-[#3b82f6] h-4 rounded-full" style="width: ${modelData.rcv_simulation.final_result.mamdani_percentage}%"></div>
                        </div>
                        <p class="font-semibold text-gray-800">${formatNumber(modelData.rcv_simulation.final_result.mamdani_votes || 0)} Votes</p>
                    </div>
                    <div class="text-center">
                        <p class="font-bold text-2xl">Andrew Cuomo</p>
                        <p class="text-6xl font-black my-2 text-[#F94144]">${modelData.rcv_simulation.final_result.cuomo_percentage}%</p>
                        <div class="w-full bg-gray-200 rounded-full h-4 my-2">
                          <div class="bg-[#F94144] h-4 rounded-full" style="width: ${modelData.rcv_simulation.final_result.cuomo_percentage}%"></div>
                        </div>
                        <p class="font-semibold text-gray-800">${formatNumber(modelData.rcv_simulation.final_result.cuomo_votes || 0)} Votes</p>
                    </div>
                </div>
            </div>`;
        
        container.innerHTML = html;
    }
    
    // Update gauge needle
    function updateGaugeNeedle(winProb) {
        const needle = document.getElementById('gauge-needle');
        if (needle) {
            const rotation = (winProb / 100) * 180 - 90;
            needle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
        }
    }
    
    // Initialize charts
    function initializeCharts() {
        const FONT_COLOR = '#1f2937'; 
        const GRID_COLOR = '#e5e7eb';
        const PALETTE = {
            red: '#F94144',
            orangeDark: '#F3722C',
            orangeMid: '#F8961E',
            yellow: '#F9C74F',
            green: '#90BE6D',
            blue: '#3b82f6',
            gray: '#9CA3AF'
        };
        const CUOMO_COLOR = PALETTE.red;
        const MAMDANI_COLOR = '#3b82f6';
        const LANDER_COLOR = PALETTE.yellow;
        const ADAMS_COLOR = PALETTE.orangeDark;
        const UNDECIDED_COLOR = PALETTE.gray;

        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        };
        
        const sharedChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: FONT_COLOR, font: { size: 14 } } },
                tooltip: {
                    callbacks: { title: tooltipTitleCallback },
                    backgroundColor: '#1F2937',
                    titleFont: { size: 16 },
                    bodyFont: { size: 14 },
                    padding: 12,
                    cornerRadius: 4
                }
            },
            scales: {
                y: { beginAtZero: true, ticks: { color: FONT_COLOR, font: { size: 12 } }, grid: { color: GRID_COLOR } },
                x: { ticks: { color: FONT_COLOR, font: { size: 12 } }, grid: { color: GRID_COLOR } }
            }
        };

        const sharedDonutOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top', labels: { color: FONT_COLOR, font: { size: 14 } } },
                tooltip: {
                    callbacks: { title: tooltipTitleCallback },
                    backgroundColor: '#1F2937',
                    titleFont: { size: 16 },
                    bodyFont: { size: 14 },
                    padding: 12,
                    cornerRadius: 4
                }
            },
            cutout: '60%'
        };

        // Early Vote Borough Chart
        if (modelData && modelData.early_voting.by_borough) {
            const boroughData = modelData.early_voting.by_borough;
            new Chart(document.getElementById('earlyVoteBoroughChart'), {
                type: 'bar',
                data: {
                    labels: boroughData.map(b => b.name),
                    datasets: [{
                        label: 'Early Votes Cast',
                        data: boroughData.map(b => b.total_votes),
                        backgroundColor: [
                            MAMDANI_COLOR,
                            PALETTE.yellow,
                            PALETTE.orangeMid,
                            PALETTE.orangeDark,
                            PALETTE.red
                        ]
                    }]
                },
                options: {
                    ...sharedChartOptions,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: {
                         y: { ...sharedChartOptions.scales.y },
                         x: { ...sharedChartOptions.scales.x, ticks: { ...sharedChartOptions.scales.x.ticks, callback: value => new Intl.NumberFormat('en-US').format(value) } }
                    }
                }
            });
        }

        // Momentum Chart
        new Chart(document.getElementById('momentumChart'), {
            type: 'line',
            data: {
                labels: ['May (Marist)', 'May (Emerson)', 'June (Marist)', 'June (Emerson)'],
                datasets: [{
                    label: 'Cuomo',
                    data: [37, 35, 38, 35],
                    borderColor: CUOMO_COLOR,
                    backgroundColor: CUOMO_COLOR + '33',
                    tension: 0.1,
                    borderWidth: 3
                }, {
                    label: 'Mamdani',
                    data: [18, 23, 27, 32],
                    borderColor: MAMDANI_COLOR,
                    backgroundColor: MAMDANI_COLOR + '33',
                    tension: 0.1,
                    borderWidth: 3
                },
                {
                    label: 'Lander',
                    data: [8, 11, 7, 13],
                    borderColor: LANDER_COLOR,
                    backgroundColor: LANDER_COLOR + '33',
                    tension: 0.1,
                    borderWidth: 3
                }]
            },
             options: {
                ...sharedChartOptions,
                scales: {
                     y: { ...sharedChartOptions.scales.y, ticks: { ...sharedChartOptions.scales.y.ticks, callback: value => value + '%' } },
                     x: { ...sharedChartOptions.scales.x }
                }
            }
        });

        // Demographics Chart
        new Chart(document.getElementById('demographicsChart'), {
            type: 'bar',
            data: {
                labels: ['Under 50', '50+', 'White', 'Black', 'Hispanic', 'Asian', 'College Grad', 'No College'],
                datasets: [{
                    label: 'Cuomo Support',
                    data: [33, 59.5, 39, 62, 60, 21, 38, 61],
                    backgroundColor: CUOMO_COLOR,
                }, {
                    label: 'Mamdani Support',
                    data: [67, 40.5, 61, 38, 40, 79, 62, 39],
                    backgroundColor: MAMDANI_COLOR,
                }]
            },
            options: {
                ...sharedChartOptions,
                indexAxis: 'y',
                scales: {
                     y: { ...sharedChartOptions.scales.y, stacked: true },
                     x: { ...sharedChartOptions.scales.x, stacked: true, ticks: { ...sharedChartOptions.scales.x.ticks, callback: value => value + '%' } }
                }
            }
        });

        // Issue Charts
        new Chart(document.getElementById('mamdaniIssuesChart'), {
            type: 'doughnut',
            data: {
                labels: ['Housing Costs', 'Other Issues'],
                datasets: [{
                    data: [59, 41],
                    backgroundColor: [MAMDANI_COLOR, UNDECIDED_COLOR],
                    hoverOffset: 4,
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: sharedDonutOptions
        });
        
        new Chart(document.getElementById('cuomoIssuesChart'), {
            type: 'doughnut',
            data: {
                labels: ['Crime', 'Other Issues'],
                datasets: [{
                    data: [36, 64],
                    backgroundColor: [CUOMO_COLOR, UNDECIDED_COLOR],
                    hoverOffset: 4,
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: sharedDonutOptions
        });
    }
    
// Handle GitHub text fade on scroll
    const githubText = document.getElementById('github-text');
    if (githubText) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 20) {
                githubText.classList.add('opacity-0');
            } else {
                githubText.classList.remove('opacity-0');
            }
        });
    }
    // Load data when page loads
    document.addEventListener('DOMContentLoaded', function () {
        loadModelData();
    });
    </script>
</body>
</html>